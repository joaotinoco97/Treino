<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treino Caseiro - Sincronizado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .sync-online {
            background: #10b981;
            color: white;
        }
        .sync-offline {
            background: #ef4444;
            color: white;
        }
        .sync-syncing {
            background: #f59e0b;
            color: white;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spinning {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Indicador de sincroniza√ß√£o -->
    <div id="syncIndicator" class="sync-indicator sync-offline">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
        </svg>
        <span id="syncText">Configurar</span>
    </div>

    <div id="app" class="p-4 pb-24">
        <div class="max-w-4xl mx-auto">
            
            <!-- Setup Screen -->
            <div id="setupScreen" class="bg-white rounded-2xl shadow-lg p-8 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üîß Configura√ß√£o Inicial</h2>
                <p class="text-gray-600 mb-6">Para sincronizar os teus dados entre dispositivos, precisas criar um ID √∫nico. Este ID serve como a tua "conta" pessoal.</p>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-blue-900 mb-2">üí° Como funciona:</h3>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>‚Ä¢ Cria ou usa um ID √∫nico (ex: "joao123")</li>
                        <li>‚Ä¢ Usa o mesmo ID em todos os dispositivos</li>
                        <li>‚Ä¢ Os dados sincronizam automaticamente</li>
                        <li>‚Ä¢ Guarda o teu ID em local seguro!</li>
                    </ul>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">O teu ID √∫nico:</label>
                        <input 
                            type="text" 
                            id="userId" 
                            placeholder="Ex: joao2024, maria_fit, etc."
                            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        >
                        <p class="text-xs text-gray-500 mt-1">Pode ser o teu nome, apelido, ou qualquer identificador √∫nico. Sem espa√ßos!</p>
                    </div>

                    <button onclick="saveUserId()" class="w-full bg-indigo-600 text-white rounded-lg py-3 font-semibold hover:bg-indigo-700 transition">
                        Come√ßar a Usar
                    </button>

                    <div class="text-center">
                        <button onclick="useLocalOnly()" class="text-sm text-gray-500 hover:text-gray-700 underline">
                            Usar sem sincroniza√ß√£o (s√≥ neste dispositivo)
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main App (inicialmente escondido) -->
            <div id="mainApp" class="hidden">
                <!-- Header -->
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="bg-indigo-600 p-3 rounded-xl">
                                <svg class="text-white w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-gray-800">Treino Caseiro</h1>
                                <p class="text-sm text-gray-500">ID: <span id="displayUserId" class="font-mono"></span></p>
                            </div>
                        </div>
                        <button onclick="changeUserId()" class="text-sm text-gray-500 hover:text-gray-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-3 mt-4">
                        <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-3">
                            <div class="flex items-center gap-1 text-indigo-600 mb-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                                </svg>
                                <span class="text-xs font-medium">Hoje</span>
                            </div>
                            <p id="todayCount" class="text-xl font-bold text-indigo-900">0</p>
                            <p class="text-xs text-indigo-600">exerc√≠cios</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-3">
                            <div class="flex items-center gap-1 text-purple-600 mb-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs font-medium">Tempo</span>
                            </div>
                            <p id="todayDuration" class="text-xl font-bold text-purple-900">0</p>
                            <p class="text-xs text-purple-600">minutos</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-3">
                            <div class="flex items-center gap-1 text-green-600 mb-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <span class="text-xs font-medium">Semana</span>
                            </div>
                            <p id="weekCount" class="text-xl font-bold text-green-900">0</p>
                            <p class="text-xs text-green-600">treinos</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Tabs -->
                <div class="bg-white rounded-2xl shadow-lg p-2 mb-6">
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="showTab('workouts')" id="tab-workouts" class="tab-active py-3 px-4 rounded-xl font-semibold text-sm transition">
                            Treinos
                        </button>
                        <button onclick="showTab('schedule')" id="tab-schedule" class="py-3 px-4 rounded-xl font-semibold text-sm transition bg-gray-100 text-gray-700 hover:bg-gray-200">
                            Planeamento
                        </button>
                        <button onclick="showTab('progress')" id="tab-progress" class="py-3 px-4 rounded-xl font-semibold text-sm transition bg-gray-100 text-gray-700 hover:bg-gray-200">
                            Progresso
                        </button>
                    </div>
                </div>

                <!-- TAB 1: WORKOUTS -->
                <div id="content-workouts">
                    <button id="showFormBtn" class="w-full bg-indigo-600 text-white rounded-xl py-4 px-6 mb-6 flex items-center justify-center gap-2 hover:bg-indigo-700 transition shadow-lg">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        <span class="font-semibold">Adicionar Exerc√≠cio</span>
                    </button>

                    <!-- Formul√°rio -->
                    <div id="workoutForm" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Novo Exerc√≠cio</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Exerc√≠cio *</label>
                                <select id="exercise" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="">Seleciona um exerc√≠cio</option>
                                    <option value="Refor√ßo muscular com pesos">Refor√ßo muscular com pesos</option>
                                    <option value="Flex√µes">Flex√µes</option>
                                    <option value="Abdominais">Abdominais</option>
                                    <option value="Agachamentos">Agachamentos</option>
                                    <option value="Burpees">Burpees</option>
                                    <option value="Prancha">Prancha</option>
                                    <option value="Lunges">Lunges</option>
                                    <option value="Mountain Climbers">Mountain Climbers</option>
                                    <option value="Jumping Jacks">Jumping Jacks</option>
                                    <option value="Tr√≠ceps">Tr√≠ceps</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Posi√ß√£o</label>
                                <input type="text" id="position" placeholder="Ex: Em p√©, Deitado, Sentado..." class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">S√©ries</label>
                                    <input type="number" id="sets" placeholder="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Segundos/s√©rie</label>
                                    <input type="number" id="secondsPerSet" placeholder="15" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Repeti√ß√µes</label>
                                <input type="number" id="reps" placeholder="12" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Dura√ß√£o (minutos)</label>
                                <input type="number" id="duration" placeholder="15" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Peso (kg)</label>
                                    <input type="number" id="weight" placeholder="10" step="0.5" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Descanso (seg)</label>
                                    <input type="number" id="restTime" placeholder="60" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Notas</label>
                                <textarea id="notes" placeholder="Como te sentiste?" rows="2" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                            </div>

                            <div class="flex gap-3 pt-2">
                                <button id="saveBtn" class="flex-1 bg-indigo-600 text-white rounded-lg py-3 font-semibold hover:bg-indigo-700 transition">
                                    Guardar
                                </button>
                                <button id="cancelBtn" class="flex-1 bg-gray-200 text-gray-700 rounded-lg py-3 font-semibold hover:bg-gray-300 transition">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de Workouts -->
                    <div id="workoutList" class="space-y-3"></div>

                    <!-- Mensagem vazia -->
                    <div id="emptyState" class="bg-white rounded-2xl shadow-lg p-12 text-center hidden">
                        <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="text-gray-400 w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                            </svg>
                        </div>
                        <p class="text-gray-500 font-medium">Ainda n√£o tens treinos registados</p>
                        <p class="text-gray-400 text-sm mt-1">Adiciona o teu primeiro exerc√≠cio!</p>
                    </div>
                </div>

                <!-- TAB 2: SCHEDULE -->
                <div id="content-schedule" class="hidden">
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Planeamento Semanal</h2>
                        <p class="text-sm text-gray-600 mb-6">Planeia os teus treinos para cada dia da semana</p>
                        
                        <div id="weekSchedule" class="space-y-3"></div>
                    </div>
                </div>

                <!-- TAB 3: PROGRESS -->
                <div id="content-progress" class="hidden">
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Progresso</h2>
                        <div class="mb-6">
                            <canvas id="progressChart" height="250"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Estat√≠sticas por Exerc√≠cio</h2>
                        <div id="exerciseStats" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // NOTA: ESTE √â UM EXEMPLO COM FIREBASE
        // Para funcionar, precisas de criar um projeto Firebase gratuito
        // Instru√ß√µes detalhadas no README

        // Configura√ß√£o Firebase (substitui com os teus dados)
        const firebaseConfig = {
            apiKey: "AIzaSyAW3wMwwF4JxdZo_oq0In_iFIvsgJcAo58",
            authDomain: "treino-caseiro.firebaseapp.com",
            databaseURL: "https://treino-caseiro-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "treino-caseiro",
            storageBucket: "treino-caseiro.firebasestorage.app",
            messagingSenderId: "193739129717",
            appId: "1:193739129717:web:521f9c571e86fa743e893c"
        };

        let database;
        let currentUserId = null;
        let workouts = [];
        let weeklyPlan = {};
        let progressChart = null;
        let isFirebaseConfigured = false;
        const weekDays = ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado', 'Domingo'];

        // Verificar se Firebase est√° configurado
        function checkFirebaseConfig() {
            return firebaseConfig.apiKey !== "SUA_API_KEY_AQUI";
        }

        // Inicializar app
        function initApp() {
            const storedUserId = localStorage.getItem('workoutUserId');
            
            if (storedUserId) {
                currentUserId = storedUserId;
                document.getElementById('setupScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('displayUserId').textContent = currentUserId;
                
                if (checkFirebaseConfig()) {
                    initFirebase();
                } else {
                    loadLocalData();
                    updateSyncIndicator('offline', 'Sem sincroniza√ß√£o');
                }
            }
        }

        // Inicializar Firebase
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                isFirebaseConfigured = true;
                
                // Escutar mudan√ßas em tempo real
                listenToWorkouts();
                listenToWeeklyPlan();
                
                updateSyncIndicator('online', 'Sincronizado');
            } catch (error) {
                console.error('Erro ao inicializar Firebase:', error);
                loadLocalData();
                updateSyncIndicator('offline', 'Erro na sincroniza√ß√£o');
            }
        }

        // Atualizar indicador de sincroniza√ß√£o
        function updateSyncIndicator(status, text) {
            const indicator = document.getElementById('syncIndicator');
            const textEl = document.getElementById('syncText');
            
            indicator.className = 'sync-indicator sync-' + status;
            textEl.textContent = text;
        }

        // Guardar User ID
        function saveUserId() {
            const input = document.getElementById('userId');
            const userId = input.value.trim().replace(/\s+/g, '_');
            
            if (!userId) {
                alert('Por favor insere um ID');
                return;
            }
            
            localStorage.setItem('workoutUserId', userId);
            currentUserId = userId;
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('displayUserId').textContent = userId;
            
            if (checkFirebaseConfig()) {
                initFirebase();
            } else {
                loadLocalData();
                updateSyncIndicator('offline', 'Local apenas');
            }
        }

        // Usar apenas local
        function useLocalOnly() {
            const userId = 'local_' + Date.now();
            localStorage.setItem('workoutUserId', userId);
            currentUserId = userId;
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('displayUserId').textContent = 'Local';
            
            loadLocalData();
            updateSyncIndicator('offline', 'Sem sincroniza√ß√£o');
        }

        // Mudar User ID
        function changeUserId() {
            if (confirm('Tens a certeza? Isto ir√° mudar para outra conta.')) {
                localStorage.removeItem('workoutUserId');
                location.reload();
            }
        }

        // Carregar dados locais (fallback)
        function loadLocalData() {
            const storedWorkouts = localStorage.getItem('workouts_' + currentUserId);
            const storedPlan = localStorage.getItem('weeklyPlan_' + currentUserId);
            
            if (storedWorkouts) workouts = JSON.parse(storedWorkouts);
            if (storedPlan) weeklyPlan = JSON.parse(storedPlan);
            
            renderAll();
        }

        // Guardar dados locais
        function saveLocal() {
            localStorage.setItem('workouts_' + currentUserId, JSON.stringify(workouts));
            localStorage.setItem('weeklyPlan_' + currentUserId, JSON.stringify(weeklyPlan));
        }

        // Escutar workouts no Firebase
        function listenToWorkouts() {
            if (!isFirebaseConfigured) return;
            
            database.ref('users/' + currentUserId + '/workouts').on('value', (snapshot) => {
                const data = snapshot.val();
                workouts = data ? Object.values(data) : [];
                renderAll();
            });
        }

        // Escutar plano semanal no Firebase
        function listenToWeeklyPlan() {
            if (!isFirebaseConfigured) return;
            
            database.ref('users/' + currentUserId + '/weeklyPlan').on('value', (snapshot) => {
                weeklyPlan = snapshot.val() || {};
                renderWeekSchedule();
            });
        }

        // Adicionar workout
        function addWorkout() {
            const exercise = document.getElementById('exercise').value;
            if (!exercise) {
                alert('Por favor seleciona um exerc√≠cio');
                return;
            }

            const workout = {
                id: Date.now(),
                exercise: exercise,
                position: document.getElementById('position').value,
                sets: document.getElementById('sets').value,
                secondsPerSet: document.getElementById('secondsPerSet').value,
                reps: document.getElementById('reps').value,
                duration: document.getElementById('duration').value,
                weight: document.getElementById('weight').value,
                restTime: document.getElementById('restTime').value,
                notes: document.getElementById('notes').value,
                date: new Date().toISOString()
            };

            if (isFirebaseConfigured) {
                updateSyncIndicator('syncing', 'A sincronizar...');
                database.ref('users/' + currentUserId + '/workouts/' + workout.id).set(workout)
                    .then(() => {
                        updateSyncIndicator('online', 'Sincronizado');
                    })
                    .catch(() => {
                        updateSyncIndicator('offline', 'Erro ao sincronizar');
                    });
            } else {
                workouts.unshift(workout);
                saveLocal();
                renderAll();
            }

            hideForm();
        }

        // Eliminar workout
        function deleteWorkout(id) {
            if (confirm('Tens a certeza?')) {
                if (isFirebaseConfigured) {
                    database.ref('users/' + currentUserId + '/workouts/' + id).remove();
                } else {
                    workouts = workouts.filter(w => w.id !== id);
                    saveLocal();
                    renderAll();
                }
            }
        }

        // Adicionar ao plano
        function addToPlan(day) {
            const exercise = prompt('Que exerc√≠cio queres adicionar a ' + day + '?', 'Flex√µes');
            if (exercise && exercise.trim()) {
                if (!weeklyPlan[day]) weeklyPlan[day] = [];
                weeklyPlan[day].push(exercise.trim());
                
                if (isFirebaseConfigured) {
                    database.ref('users/' + currentUserId + '/weeklyPlan/' + day).set(weeklyPlan[day]);
                } else {
                    saveLocal();
                    renderWeekSchedule();
                }
            }
        }

        // Remover do plano
        function removeFromPlan(day, index) {
            weeklyPlan[day].splice(index, 1);
            
            if (isFirebaseConfigured) {
                database.ref('users/' + currentUserId + '/weeklyPlan/' + day).set(weeklyPlan[day]);
            } else {
                saveLocal();
                renderWeekSchedule();
            }
        }

        // Formatar data
        function formatDate(isoString) {
            const date = new Date(isoString);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            const timeStr = date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });

            if (date.toDateString() === today.toDateString()) {
                return `Hoje √†s ${timeStr}`;
            } else if (date.toDateString() === yesterday.toDateString()) {
                return `Ontem √†s ${timeStr}`;
            }
            return date.toLocaleDateString('pt-PT', { day: 'numeric', month: 'short' }) + ` √†s ${timeStr}`;
        }

        // Alternar tabs
        function showTab(tab) {
            document.getElementById('content-workouts').classList.add('hidden');
            document.getElementById('content-schedule').classList.add('hidden');
            document.getElementById('content-progress').classList.add('hidden');
            
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
            });
            
            document.getElementById('content-' + tab).classList.remove('hidden');
            const activeBtn = document.getElementById('tab-' + tab);
            activeBtn.classList.add('tab-active');
            activeBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
            
            if (tab === 'progress') {
                updateProgress();
            }
        }

        // Mostrar/esconder formul√°rio
        function showForm() {
            document.getElementById('workoutForm').classList.remove('hidden');
            document.getElementById('showFormBtn').classList.add('hidden');
        }

        function hideForm() {
            document.getElementById('workoutForm').classList.add('hidden');
            document.getElementById('showFormBtn').classList.remove('hidden');
            document.getElementById('exercise').value = '';
            document.getElementById('position').value = '';
            document.getElementById('sets').value = '';
            document.getElementById('secondsPerSet').value = '';
            document.getElementById('reps').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('restTime').value = '';
            document.getElementById('notes').value = '';
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            const today = new Date().toDateString();
            const todayWorkouts = workouts.filter(w => 
                new Date(w.date).toDateString() === today
            );
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekWorkouts = workouts.filter(w => 
                new Date(w.date) >= weekAgo
            );
            
            const count = todayWorkouts.length;
            const totalDuration = todayWorkouts.reduce((sum, w) => sum + (parseInt(w.duration) || 0), 0);

            document.getElementById('todayCount').textContent = count;
            document.getElementById('todayDuration').textContent = totalDuration;
            document.getElementById('weekCount').textContent = weekWorkouts.length;
        }

        // Renderizar workouts
        function renderWorkouts() {
            const list = document.getElementById('workoutList');
            const emptyState = document.getElementById('emptyState');

            if (workouts.length === 0) {
                list.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            
            // Ordenar por data (mais recente primeiro)
            const sortedWorkouts = [...workouts].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            list.innerHTML = sortedWorkouts.map(workout => `
                <div class="bg-white rounded-xl shadow-md p-5 hover:shadow-lg transition">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800">${workout.exercise}</h3>
                            ${workout.position ? `<p class="text-sm text-indigo-600 font-medium mt-0.5">üìç ${workout.position}</p>` : ''}
                            <div class="flex items-center gap-2 text-sm text-gray-500 mt-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span>${formatDate(workout.date)}</span>
                            </div>
                        </div>
                        <button onclick="deleteWorkout(${workout.id})" class="text-red-500 hover:bg-red-50 p-2 rounded-lg transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="flex flex-wrap gap-3 mb-2">
                        ${workout.sets ? `<span class="bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm font-medium">${workout.sets} s√©ries</span>` : ''}
                        ${workout.secondsPerSet ? `<span class="bg-teal-50 text-teal-700 px-3 py-1 rounded-full text-sm font-medium">${workout.secondsPerSet}s/s√©rie</span>` : ''}
                        ${workout.reps ? `<span class="bg-purple-50 text-purple-700 px-3 py-1 rounded-full text-sm font-medium">${workout.reps} reps</span>` : ''}
                        ${workout.weight ? `<span class="bg-orange-50 text-orange-700 px-3 py-1 rounded-full text-sm font-medium">${workout.weight} kg</span>` : ''}
                        ${workout.restTime ? `<span class="bg-gray-50 text-gray-700 px-3 py-1 rounded-full text-sm font-medium">${workout.restTime}s descanso</span>` : ''}
                        ${workout.duration ? `<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">${workout.duration} min total</span>` : ''}
                    </div>

                    ${workout.notes ? `<p class="text-sm text-gray-600 mt-3 italic border-l-2 border-gray-200 pl-3">${workout.notes}</p>` : ''}
                </div>
            `).join('');
        }

        // Renderizar planeamento semanal
        function renderWeekSchedule() {
            const container = document.getElementById('weekSchedule');
            container.innerHTML = weekDays.map((day) => {
                const dayPlan = weeklyPlan[day] || [];
                return `
                    <div class="border border-gray-200 rounded-xl p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-bold text-gray-800">${day}</h3>
                            <button onclick="addToPlan('${day}')" class="text-indigo-600 hover:bg-indigo-50 p-2 rounded-lg transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="space-y-2">
                            ${dayPlan.length === 0 ? 
                                '<p class="text-sm text-gray-400">Sem treinos planeados</p>' :
                                dayPlan.map((exercise, idx) => `
                                    <div class="flex justify-between items-center bg-gray-50 rounded-lg p-3">
                                        <span class="text-sm font-medium text-gray-700">${exercise}</span>
                                        <button onclick="removeFromPlan('${day}', ${idx})" class="text-red-500 hover:bg-red-50 p-1 rounded">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar gr√°fico de progresso
        function updateProgress() {
            const days = 14;
            const labels = [];
            const data = [];
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayWorkouts = workouts.filter(w => 
                    new Date(w.date).toDateString() === dateStr
                );
                
                labels.push(date.toLocaleDateString('pt-PT', { day: 'numeric', month: 'short' }));
                data.push(dayWorkouts.length);
            }

            if (progressChart) {
                progressChart.destroy();
            }

            const ctx = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Exerc√≠cios por dia',
                        data: data,
                        borderColor: 'rgb(99, 102, 241)',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            renderExerciseStats();
        }

        // Estat√≠sticas por exerc√≠cio
        function renderExerciseStats() {
            const stats = {};
            workouts.forEach(w => {
                if (!stats[w.exercise]) {
                    stats[w.exercise] = { count: 0, totalWeight: 0, totalDuration: 0 };
                }
                stats[w.exercise].count++;
                stats[w.exercise].totalWeight += parseFloat(w.weight) || 0;
                stats[w.exercise].totalDuration += parseInt(w.duration) || 0;
            });

            const container = document.getElementById('exerciseStats');
            const entries = Object.entries(stats).sort((a, b) => b[1].count - a[1].count);
            
            if (entries.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Sem dados ainda</p>';
                return;
            }

            container.innerHTML = entries.map(([exercise, data]) => `
                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4">
                    <h4 class="font-bold text-gray-800 mb-2">${exercise}</h4>
                    <div class="grid grid-cols-3 gap-2 text-sm">
                        <div>
                            <p class="text-gray-500 text-xs">Vezes</p>
                            <p class="font-bold text-indigo-600">${data.count}</p>
                        </div>
                        ${data.totalWeight > 0 ? `
                            <div>
                                <p class="text-gray-500 text-xs">Peso total</p>
                                <p class="font-bold text-purple-600">${data.totalWeight} kg</p>
                            </div>
                        ` : ''}
                        ${data.totalDuration > 0 ? `
                            <div>
                                <p class="text-gray-500 text-xs">Tempo total</p>
                                <p class="font-bold text-blue-600">${data.totalDuration} min</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Renderizar tudo
        function renderAll() {
            updateStats();
            renderWorkouts();
            renderWeekSchedule();
        }

        // Event listeners
        document.getElementById('showFormBtn').addEventListener('click', showForm);
        document.getElementById('saveBtn').addEventListener('click', addWorkout);
        document.getElementById('cancelBtn').addEventListener('click', hideForm);

        // Iniciar app
        initApp();
    </script>
</body>
</html>
